import{writeFile as e}from"fs";import{loadEnv as o}from"vite";function t(o,t,n){o.data=function(e,o){const t=`window.${e.globalName}`;return`${t}=${JSON.stringify(o,void 0,2)};\n  Object.freeze(${t});\n  Object.defineProperty(window, "${e.globalName}", {\n    configurable: false,\n    writable: false,\n  });`}(o,n)+(o.data?o.data:""),o.file=t+o.file,e(o.file,o.data,o.options||{},(e=>{if(e)return o.reject&&o.reject(e),void console.error("settings creates fail,you maybe need rebuild"+e);o.resolve&&o.resolve(e),console.info("settings create success!!!")}))}function n(e,n){let i,r;return{apply:"build",name:"write-env-in-dist",configResolved(e){i=e},config:(...e)=>{r=e[1].mode},closeBundle(){const n=o(r,process.cwd());let s=`${i.root}/${i.build.outDir}/`;!function(e,o,n){Array.isArray(e)?e.forEach((e=>{t(e,o,Object.assign({},n,e.config))})):t(e,o,Object.assign({},n,e.config))}(e,s,n)}}}export default n;export{n as generateConfigIntoDist};
