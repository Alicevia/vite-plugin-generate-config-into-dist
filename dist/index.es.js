import{writeFile as e}from"fs";import{loadEnv as o}from"vite";function n(o,n,t){o.data=function(e,o){const n=`window.${e.globalName}`;return`${n}=${JSON.stringify(o,void 0,2)};\n  Object.freeze(${n});\n  Object.defineProperty(window, "${e.globalName}", {\n    configurable: false,\n    writable: false,\n  });`}(o,t)+(o.data?o.data:""),o.file=n+o.file,e(o.file,o.data,o.options||{},(e=>{if(e)return o.reject&&o.reject(e),void console.error("settings创建失败,你可能需要重新打包"+e);o.resolve&&o.resolve(e),console.info("settings创建成功")}))}function t(e,t){let i,r;return{apply:"build",name:"write-env-in-dist",configResolved(e){i=e},config:(...e)=>{r=e[1].mode},closeBundle(){console.log(t,"sdf");const s=o(r,process.cwd());let l=`${i.root}/${i.build.outDir}/`;!function(e,o,t){Array.isArray(e)?e.forEach((e=>{n(e,o,Object.assign({},t,e.config))})):n(e,o,Object.assign({},t,e.config))}(e,l,s)}}}export default t;export{t as generateConfigIntoDist};
